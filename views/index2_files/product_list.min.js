$define(["wgt_util","jquery.dialogMgr","jquery.adFocus","js/pagination/initPagination","wgt_readyload","paging"],function($0,$,$1,focus,initPagination,r,page){function getAjaxData(t,a){var i;return $.ajax({type:"POST",url:t,data:a,async:!1,success:function(t){i=t}}),i}function specialHtmlHide(t,a){t.find(".p_interaction,.p_InteractionInfo").each(function(){var t=$(this).children("div:visible").length||$(this).children("a").children("div:visible").length;a&&"false"!=a&&0==t&&$(this).remove()})}function getIframeParam(t,a,i){var e=$compCl.getScope(t.id);return{id:t.id,cls:t.styleId,scp:e,htmlType:"singleRow",dialogSrc:i||"",popupName:a.popupName,dialogWidth:a.popupWidth,dialogHeight:a.popupHeight,dialogEsStyle:t.es_PopupWindow,closeEsStyle:t.es_CloseBtn,shadeEsStyle:t.es_shade,popupAnimationEffect:a.animationEffect,popupAnimationTimeLong:a.animationTimeLong,popupState:a.popupState}}function linkSkipFun(t,a,i,e){"_popup"==i?e&&t.data(e).show({dialogSrc:a}):"_blank"==i?$.openNewWindow(a):$.openHref(a),$._UTL.stopEvent(event)}function productCVFDataShow(a,t,i,e,r){var n=a.find(r).parent();if(n&&0<n.length&&!n.hasClass("item_hide")){var o=a.find(".p_Product"),s=new Array(o.length);o.each(function(t){s[t]=$(this).attr("dataId")});var p=getAjaxData(t,{appId:i,id:s.toString(),f:e}),u=$.parseJSON(p);u&&"0"==u.code?u.data.forEach(function(t){a.find("div.p_Product[dataId="+t.id+"]").find(r).find(".font").html("<i class='iconfont'></i>"+(t.format||0))}):console.log("请求返回的数据异常")}}function productCVF(t,a){productCVFDataShow(t,"/message/ajax/nums.do",a.appId,a.commentRule,".p_comment")}function moveAnimatonFunction(scp,params){var ainimateConfig=params.ainimateConfig;ainimateConfig.comps=scp.find(".p_Product"),ainimateConfig.isOpen=eval(ainimateConfig.isOpen),ainimateConfig.type=parseInt(ainimateConfig.type)||3,$.overAnimate(ainimateConfig)}function createImages(t,e,r){t.find(".p_images").each(function(t){r.ThumbnailBox;var a=jQuery.extend(!0,{},e),i=$(this).attr("imgData");$(this).removeAttr("imgData"),i&&(a.data=JSON.parse(i),$(this).adFocus(a))})}function listPagination(t){var e=$compCl.getScope(t.id),a=getUrl();t.params={totalPages:parseInt(t.totalPages),currentPage:parseInt(t.currentPage),pageSize:parseInt(t.pageSize),url:a},initPagination._params=t,initPagination._params.params.callback=function(t,a){var i=getAjaxData(t,a.requestParam);e.html(i),window.baguetteBox&&baguetteBox.run(".baguetteBoxOne")},initPagination.init()}function buttonClickFun(i){var n=$compCl.getScope(i.id),o=i.linkJson,e=o.inquiry_link_url.target,r=o.inquiry_link_url.url;r&&(r+="?productId="+n.find(".p_Product:first").attr("dataId")),i.inquiryPopupWindow&&$.dialogIframe(getIframeParam(i,i.inquiryPopupWindow,r)),n.find(".p_inquiry").unbind("click").bind("click",function(){if(o.inquiry_link&&o.inquiry_link_url.url){var t=$(this).parents(".p_Product").attr("dataId");r=o.inquiry_link_url.url+"?productId="+t,"_popup"!=e&&(r+="&pageId="+$("body").attr("data-pageid"));var a=i.inquiryPopupWindow?i.inquiryPopupWindow.popupName:null;linkSkipFun(n,r,e,a)}}),n.find(".p_btnA,.p_buy,.p_AddCart").each(function(){var r=$.grep($(this).attr("class").split(" "),function(t,a){return t&&-1!=t.indexOf("p_")})[0].split("p_")[1];$(this).unbind("click").bind("click",function(){var t=$(this).parents(".p_Product").attr("dataId");if("btnA"==r){var a=o[r+"_link"]&&o[r+"_link_url"].url,i=o[r+"_link_url"].target,e=o[r+"_link_url"].url+"?productId="+t;a&&linkSkipFun(n,e,i,"")}})})}function textSubstring(t){t.find(".js_singleLine").each(function(){var t=$(this).attr("autoSize");t||(t=1),$(this).fixLineN(t)}),t.find(".p_keywords").each(function(){var t=$(this).attr("autoCut"),a=$(this).find(".d_keyword");if("true"==t&&0<a.length){var i=$(this).height(),e=parseInt($(this).attr("autoSize"))||1,r=a.find(".font").css("line-height"),n=parseInt(r.substring(0,r.length-2));n*e<i&&$(this).css("height",n*e)}})}function addProClickEvent(t,a){createImages(a,t.imageOpts,t),textSubstring(a),productCVF(a,t),moveAnimatonFunction(a,t)}function getUrl(){return"/comp/product/list.do"}function getSortParams(s){var p=$compCl.getScope(s.id),t=s.requestParam.orderColumn||"def",a=!0;s.requestParam.orderType&&"0"==s.requestParam.orderType&&(a=!1);var i={key:t,downArraw:a},e={click:function(t,a,i,e){if("def"==i.key){a.attr("lang","active");var r=a.siblings();$.resetOtherSort(r,e),s.requestParam.orderColumn=i.key,s.requestParam.orderType=""}else{$.triggerProductSort(a,i,e);var n=a.data("productCount");s.requestParam.orderColumn=i.key,s.requestParam.orderType=n}var o=getAjaxData(getUrl(),s.requestParam);p.html(o)}};return{item:[{show:!0,type:"sort",key:"def",v:s.sortParams.DEFAULT_SORT.v,title:s.sortParams.DEFAULT_SORT.title,downArraw:!0,action:e},{show:s.sortParams.PUBLISH_TIME.show,type:"sort",key:"PUBLISH_TIME",v:s.sortParams.PUBLISH_TIME.v,title:s.sortParams.PUBLISH_TIME.title,downArraw:!0,action:e},{show:s.sortParams.PRODUCT_NAME.show,type:"sort",key:"PRODUCT_NAME",v:s.sortParams.PRODUCT_NAME.v,title:s.sortParams.PRODUCT_NAME.title,downArraw:!1,action:e},{show:s.sortParams.PVS.show,type:"sort",key:"PVS",v:s.sortParams.PVS.v,title:s.sortParams.PVS.title,downArraw:!0,action:e},{show:s.sortParams.comment.show,type:"sort",key:"comment",v:s.sortParams.comment.v,title:s.sortParams.comment.title,downArraw:!0,action:e},{show:s.sortParams.PRODUCT_CODE.show,type:"sort",key:"PRODUCT_CODE",v:s.sortParams.PRODUCT_CODE.v,title:s.sortParams.PRODUCT_CODE.title,downArraw:!1,action:e}],elements:{def:{style:s.sortParams.DEFAULT_SORT.style,zstyle:"p_default",tstyle:""},PUBLISH_TIME:{style:s.sortParams.PUBLISH_TIME.style,zstyle:"p_TimeSort",tstyle:"i_TimeSort"},PRODUCT_NAME:{style:s.sortParams.PRODUCT_NAME.style,zstyle:"p_NameSort",tstyle:"i_NameSort"},PVS:{style:s.sortParams.PVS.style,zstyle:"p_ViewSort",tstyle:"i_ViewSort"},comment:{style:s.sortParams.comment.style,zstyle:"p_CommentSort",tstyle:"i_CommentSort"},PRODUCT_CODE:{style:s.sortParams.PRODUCT_CODE.style,zstyle:"p_NoSort",tstyle:"i_NoSort"}},defVal:i}}function addGoDetailClick(i){var e=$compCl.getScope(i.id);if(i.detailPopupWindow){var t=e.find(".p_Product:first").find(".p_images").attr("data-url");$.dialogIframe(getIframeParam(i,i.detailPopupWindow,t))}e.find(".js-protitle").unbind("click").bind("click",function(){var t=$(this).attr("data-url"),a=$(this).attr("data-target");gotoDetail(e,t,a,i)}),e.find(".p_images").unbind("click").bind("click",function(){var t=$(this).attr("data-url"),a=$(this).attr("data-target");gotoDetail(e,t,a,i)})}function gotoDetail(scp,url,target,params){var detailPopupName;params.detailPopupWindow&&eval(params.detailPopupWindow.PopupWindow)&&(target="_popup",detailPopupName=params.detailPopupWindow.popupName),linkSkipFun(scp,url,target,detailPopupName)}function pageTurnFun(i,e){if("turnPage"==(e.turnPageType||"turnPage"))listPagination(e),addProClickEvent(e,i);else{var t={firstRefresh:!1};t.url=getUrl(),t.data=e.requestParam,t.successFun=function(t){var a=t&&0<t.length?t:i;addProClickEvent(e,a)},i.find(".p_products").paging(t)}}var init=function(){var t=this._params,a=$compCl.getScope(t.id);a.find(".p_sort").createProductSort(getSortParams(t)).init(),pageTurnFun(a,t),addGoDetailClick(t),buttonClickFun(t),a.find("img").onErrorImg(),r.lazyImg({defObj:"#"+a.attr("id")}),setTimeout(function(){r.setCompPostion()},1500),r.lazyImg({defObj:"body"})};return{init:init}});